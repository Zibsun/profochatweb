# Требования: Редактор списка курсов

**Версия:** 1.0  
**Дата:** 2024-12  
**Статус:** Требования  
**Приоритет:** Высокий

---

## Краткое резюме

Этот документ описывает требования для реализации редактора списка курсов - интерфейса для управления метаданными курсов из файла `courses.yml`. Редактор позволяет:

- Просматривать список всех курсов из `courses.yml`
- Редактировать метаданные курсов (path, element, restricted, decline_text, ban_enabled, ban_text)
- Переходить к редактированию содержимого курса через ссылку
- Создавать новые записи курсов в `courses.yml`
- Удалять курсы из списка

**Связь с редактором курса:** Редактор списка курсов является точкой входа для работы с курсами. Из него можно перейти к редактированию содержимого курса через редактор курса (`/course-editor/[course_id]`).

---

## 1. Обзор

**Контекст:** Редактор списка курсов работает с метаданными курсов из файла `courses.yml`. Метаданные определяют, где хранится курс (YAML файл или база данных), с какого элемента начинать курс, ограничения доступа и настройки блокировок. Подробнее о работе бота с курсами см. `docs/telegram_bot_courses.md`.

### 1.1 Текущее состояние

В настоящее время существует:

- ✅ API endpoint `GET /api/course-editor/courses` - возвращает список всех курсов из `courses.yml`
- ✅ API endpoint `GET /api/course-editor/courses/{course_id}` - возвращает данные конкретного курса
- ✅ API endpoint `PUT /api/course-editor/courses/{course_id}` - сохраняет изменения курса
- ✅ API endpoint `POST /api/course-editor/courses` - создает новый курс
- ✅ Страница `/course-editor/[courseId]` - редактор содержимого курса
- ✅ Функции в `yaml-utils.ts` для работы с `courses.yml`:
  - `loadCoursesYaml()` - загрузка списка курсов
  - `saveCoursesYaml()` - сохранение списка курсов
  - `getCourseMetadata()` - получение метаданных курса
  - `updateCourseMetadata()` - обновление метаданных курса
  - `addCourseToCoursesYaml()` - добавление нового курса

**Отсутствует:**
- ❌ Страница для просмотра и редактирования списка курсов
- ❌ UI для редактирования метаданных курсов
- ❌ API endpoint для обновления метаданных курса без изменения содержимого
- ❌ API endpoint для удаления курса из списка

### 1.2 Целевое состояние

Редактор списка курсов должен предоставлять:

- Страницу `/course-editor` (или `/course-editor/list`) со списком всех курсов
- Таблицу/список курсов с отображением основных метаданных
- Возможность редактирования метаданных каждого курса
- Кнопку/ссылку для перехода к редактированию содержимого курса
- Возможность создания новой записи курса в `courses.yml`
- Возможность удаления курса из списка (с подтверждением)

---

## 2. Структура данных

### 2.1 Формат courses.yml

Файл `courses.yml` содержит метаданные всех доступных курсов. Файл находится в папке `scripts/{bot_folder}/courses.yml` и определяет:
- Где хранится курс (YAML файл или база данных)
- С какого элемента начинать курс
- Ограничения доступа к курсу
- Настройки блокировок пользователей

**Базовый формат:**
```yaml
course_id:
  path: scripts/course_file.yml  # Путь к файлу курса или "db" для БД
  element: StartElement           # Опционально: начальный элемент
  restricted: yes                 # Опционально: ограниченный доступ (yes/no или true/false)
  decline_text: "..."             # Опционально: текст отказа
  ban_enabled: yes                # Опционально: включены блокировки (yes/no или true/false)
  ban_text: "..."                 # Опционально: текст блокировки
```

**Особенности:**
- `course_id` - уникальный идентификатор курса (ключ верхнего уровня)
- `path` - обязательное поле, путь к YAML файлу курса или `"db"` для курсов из БД
- Все остальные поля опциональны
- `restricted` и `ban_enabled` могут быть строковыми (`"yes"`/`"no"`) или булевыми (`true`/`false`)
- При загрузке пути нормализуются: если путь не начинается с `scripts/`, автоматически добавляется префикс `scripts/{bot_folder}/`

**Примеры метаданных:**

**Простой курс:**
```yaml
default:
  path: scripts/default.yml
```

**Курс с начальным элементом:**
```yaml
us:
  path: scripts/userstory.yml
  element: Course_intro_end
```

**Ограниченный курс:**
```yaml
forming2:
  path: scripts/teacher.yaml
  restricted: "yes"
  decline_text: |
    Хочешь присоединиться к курсу? Регистрируйся! 
    https://trendyenglish.ru/page53699999.html
```

**Курс из базы данных:**
```yaml
testdb:
  path: db
```

**Курс с блокировками:**
```yaml
course_with_ban:
  path: scripts/course.yml
  ban_enabled: yes
  ban_text: |
    ⚠️ Извини, но мы уже исчерпали лимит общения, 
    и наш бюджет на использование ИИ превышен.
```

### 2.2 Расширенные курсы (ext_courses)

Для динамического добавления курсов из базы данных или другого файла используется специальный ключ `ext_courses`:

```yaml
ext_courses:
  path: db  # или path: another_courses.yml
```

**Механизм работы:**
- Если в `courses.yml` присутствует ключ `ext_courses`:
  - Если `path: db`, курсы загружаются из таблицы `course` в базе данных
  - Если `path: file.yml`, курсы загружаются из указанного YAML файла
  - Все курсы из `ext_courses` имеют `path: "db"` (для БД) или соответствующий путь
  - **Важно:** Курсы из `ext_courses` переопределяют курсы с теми же `course_id` из основного файла
  - Курс `default` также может быть переопределен через `ext_courses`

**Обработка в редакторе:**
- Редактор должен отображать курсы из `ext_courses` вместе с основными курсами
- При редактировании курса из `ext_courses` (БД) нужно учитывать, что метаданные хранятся в БД, а не в `courses.yml`
- При удалении курса с `path: "db"` нужно предупредить, что курс останется в БД

### 2.2 Интерфейс CourseMetadata

```typescript
interface CourseMetadata {
  course_id: string;              // Уникальный идентификатор курса
  path: string;                   // Путь к файлу курса или "db"
  element?: string;               // Начальный элемент (опционально)
  restricted?: boolean | string;   // Ограниченный доступ (опционально)
  decline_text?: string;          // Текст отказа (опционально)
  ban_enabled?: boolean | string;  // Включены блокировки (опционально)
  ban_text?: string;             // Текст блокировки (опционально)
}
```

---

## 3. Функциональные требования

### 3.1 Просмотр списка курсов

#### FR-1: Отображение списка курсов

**Описание:** Страница должна отображать список всех курсов из `courses.yml`.

**Требования:**
- Загрузка списка курсов через `GET /api/course-editor/courses`
- Отображение в виде таблицы или карточек
- Показ основных полей для каждого курса:
  - `course_id` (идентификатор)
  - `path` (путь к файлу или `"db"` для курсов из БД)
  - `element` (начальный элемент, если указан)
  - `restricted` (ограниченный доступ, если указан)
  - `ban_enabled` (блокировки включены, если указано)
- **Индикация курсов с `path: "db"`:**
  - Визуально отличать курсы из БД от файловых курсов (например, значок БД или другой цвет)
  - Показывать предупреждение при попытке редактирования метаданных курса из БД
  - Для курсов из БД метаданные могут храниться в таблице `course`, а не в `courses.yml`
- Индикация состояния загрузки (loading state)
- Обработка ошибок загрузки
- Отображение курсов из `ext_courses` вместе с основными курсами

**UI элементы:**
- Таблица со столбцами: Course ID, Path, Element, Restricted, Ban Enabled, Actions
- Или карточки с информацией о курсе и кнопками действий

#### FR-2: Фильтрация и поиск

**Описание:** Возможность фильтровать и искать курсы в списке.

**Требования:**
- Поиск по `course_id`
- Фильтр по `path` (все / файлы / БД)
- Фильтр по `restricted` (все / да / нет)
- Фильтр по `ban_enabled` (все / да / нет)

**Приоритет:** Средний (можно добавить в следующей итерации)

### 3.2 Редактирование метаданных курса

#### FR-3: Редактирование метаданных

**Описание:** Возможность редактировать метаданные курса без изменения содержимого курса.

**Требования:**
- Редактирование полей:
  - `path` - путь к файлу курса (валидация пути)
  - `element` - начальный элемент (опционально)
  - `restricted` - ограниченный доступ (чекбокс или переключатель)
  - `decline_text` - текст отказа (многострочное текстовое поле)
  - `ban_enabled` - включены блокировки (чекбокс или переключатель)
  - `ban_text` - текст блокировки (многострочное текстовое поле)
- Валидация:
  - `course_id` не может быть пустым
  - `path` не может быть пустым
  - `path` должен быть валидным путем (защита от path traversal)
- Сохранение изменений в `courses.yml`
- Отображение состояния сохранения (saving indicator)
- Обработка ошибок сохранения

**UI варианты:**
1. **Модальное окно** - открывается по кнопке "Edit" рядом с курсом
2. **Inline редактирование** - редактирование прямо в таблице
3. **Отдельная страница** - переход на `/course-editor/[course_id]/settings`

**Рекомендация:** Начать с модального окна для MVP.

#### FR-4: Валидация метаданных

**Описание:** Валидация данных перед сохранением.

**Правила валидации:**
- `course_id` - обязательное поле, не может быть пустым, должен содержать только допустимые символы (a-z, A-Z, 0-9, _, -)
- `path` - обязательное поле, не может быть пустым
- `path` - не может содержать `..` (защита от path traversal)
- `path` - должен быть относительным путем или начинаться с `scripts/`
- `path` - может быть `"db"` для курсов из базы данных
- `path` - при сохранении нормализуется: если не начинается с `scripts/` и не равен `"db"`, добавляется префикс `scripts/{bot_folder}/`
- `element` - опциональное поле, если указано, должно быть непустой строкой (ID элемента курса)
- `restricted` - опциональное поле, может быть `true`/`false` или `"yes"`/`"no"` (при сохранении рекомендуется нормализовать к булеву)
- `ban_enabled` - опциональное поле, может быть `true`/`false` или `"yes"`/`"no"` (при сохранении рекомендуется нормализовать к булеву)
- `decline_text` - опциональное поле, если указано, должно быть непустой строкой (используется при отказе в доступе к ограниченному курсу)
- `ban_text` - опциональное поле, если указано, должно быть непустой строкой (используется при блокировке пользователя)

**Обработка ошибок валидации:**
- Показать ошибки валидации под соответствующими полями
- Заблокировать сохранение до исправления ошибок
- Выделить проблемные поля

### 3.3 Навигация к редактору курса

#### FR-5: Переход к редактированию курса

**Описание:** Возможность перейти к редактированию содержимого курса.

**Требования:**
- Кнопка/ссылка "Edit Course" или "Редактировать курс" для каждого курса
- Переход на страницу `/course-editor/[course_id]`
- **Для курсов с `path: "db"`:**
  - Показать предупреждение при попытке редактирования содержимого курса
  - Указать, что курс хранится в базе данных и редактируется через другие интерфейсы
  - Опционально: отключить кнопку редактирования или показать модальное окно с предупреждением
- Открытие в той же вкладке или новой вкладке (настраиваемо)

**UI:**
- Кнопка в колонке "Actions" таблицы
- Или кнопка на карточке курса

### 3.4 Создание нового курса

#### FR-6: Создание записи курса в списке

**Описание:** Возможность создать новую запись курса в `courses.yml`.

**Требования:**
- Кнопка "Create Course" или "Создать курс"
- Форма создания с полями:
  - `course_id` - обязательное поле
  - `path` - обязательное поле (по умолчанию `scripts/{course_id}.yml`)
  - Остальные поля опциональны (как при редактировании)
- Валидация данных (те же правила, что и при редактировании)
- Проверка на уникальность `course_id`
- После создания - возможность сразу перейти к редактированию содержимого курса

**Процесс:**
1. Пользователь заполняет форму создания курса
2. Нажимает "Create"
3. Создается запись в `courses.yml`
4. Если файл курса не существует, создается пустой YAML файл курса
5. Пользователь может перейти к редактированию содержимого курса

**API Endpoint:**
```
POST /api/course-editor/courses/metadata
```

**Request:**
```typescript
{
  course_id: string;
  path: string;
  element?: string;
  restricted?: boolean | string;
  decline_text?: string;
  ban_enabled?: boolean | string;
  ban_text?: string;
}
```

**Response:**
```typescript
{
  course_id: string;
  path: string;
  // ... остальные поля
}
```

**Обработка ошибок:**
- 409: Курс с таким `course_id` уже существует
- 400: Ошибка валидации данных
- 500: Ошибка сохранения файла

### 3.5 Работа с ext_courses

#### FR-7: Отображение и управление ext_courses

**Описание:** Редактор должен корректно работать с курсами из `ext_courses`.

**Требования:**
- Отображать курсы из `ext_courses` вместе с основными курсами в общем списке
- Визуально отличать курсы из `ext_courses` (например, метка или цвет)
- **Для курсов из `ext_courses` с `path: db`:**
  - Показать, что курс загружается из базы данных
  - При редактировании метаданных предупредить, что изменения в `courses.yml` могут не влиять на курс, если он управляется через БД
  - При удалении предупредить, что курс останется в БД
- **Для курсов из `ext_courses` с `path: file.yml`:**
  - Показать, что курс загружается из внешнего файла
  - При редактировании метаданных обновлять соответствующий файл или `courses.yml` (в зависимости от реализации)
- **Редактирование `ext_courses`:**
  - Опционально: возможность редактировать сам ключ `ext_courses` в `courses.yml`
  - Изменение `path` в `ext_courses` влияет на загрузку всех курсов из этого источника
  - При удалении `ext_courses` все курсы из этого источника перестанут загружаться

**Приоритет:** Средний (можно добавить в следующей итерации)

### 3.6 Удаление курса

#### FR-8: Удаление курса из списка

**Описание:** Возможность удалить курс из `courses.yml`.

**Требования:**
- Кнопка "Delete" или "Удалить" для каждого курса
- Подтверждение удаления (модальное окно с предупреждением)
- Удаление записи из `courses.yml`
- Опционально: удаление YAML файла курса (если `path` указывает на файл)
- Не удалять файл курса, если он используется другими курсами

**Предупреждение при удалении:**
- Показать информацию о курсе, который будет удален
- Предупредить, что это действие нельзя отменить
- **Для курсов с `path: "db"`:**
  - Предупредить, что удаление из `courses.yml` не удалит курс из базы данных
  - Курс останется в таблице `course` и может быть снова добавлен через `ext_courses`
  - Рекомендуется показать дополнительное предупреждение о том, что для полного удаления нужно использовать другие инструменты
- **Для файловых курсов:**
  - Опционально: предложить удалить YAML файл курса (если он существует)
  - Проверить, не используется ли файл другими курсами перед удалением

**API Endpoint:**
```
DELETE /api/course-editor/courses/{course_id}
```

**Response:**
```typescript
{
  course_id: string;
  deleted: true;
  message: "Course deleted successfully";
}
```

**Обработка ошибок:**
- 404: Курс не найден
- 500: Ошибка удаления файла

**Приоритет:** Средний (можно добавить в следующей итерации)

---

## 4. Технические требования

### 4.1 API Endpoints

#### Список необходимых endpoints

**Получение списка курсов:**
```
GET /api/course-editor/courses
```
- ✅ Уже реализован
- Возвращает список всех курсов из `courses.yml`
- **Важно:** Должен включать курсы из `ext_courses` (если они присутствуют в файле)
- Курсы с `path: "db"` должны быть четко идентифицированы в ответе

**Получение метаданных курса:**
```
GET /api/course-editor/courses/{course_id}/metadata
```
- Возвращает только метаданные курса (без содержимого YAML файла)
- Более легковесный, чем `GET /api/course-editor/courses/{course_id}`

**Обновление метаданных курса:**
```
PUT /api/course-editor/courses/{course_id}/metadata
```
- Обновляет только метаданные курса в `courses.yml`
- Не изменяет содержимое YAML файла курса
- **Для курсов с `path: "db"`:**
  - Метаданные могут храниться в таблице `course` в БД, а не в `courses.yml`
  - Нужно проверить, откуда загружен курс, и обновить соответствующий источник
  - Если курс из `ext_courses` с `path: db`, обновление в `courses.yml` может не иметь эффекта

**Request:**
```typescript
{
  path?: string;
  element?: string;
  restricted?: boolean | string;
  decline_text?: string;
  ban_enabled?: boolean | string;
  ban_text?: string;
}
```

**Response:**
```typescript
{
  course_id: string;
  path: string;
  element?: string;
  restricted?: boolean | string;
  decline_text?: string;
  ban_enabled?: boolean | string;
  ban_text?: string;
  updated_at: string;
}
```

**Создание записи курса:**
```
POST /api/course-editor/courses/metadata
```
- Создает новую запись в `courses.yml`
- Опционально создает пустой YAML файл курса, если его нет
- **Нормализация пути:**
  - Если путь не начинается с `scripts/` и не равен `"db"`, автоматически добавляется префикс `scripts/{bot_folder}/`
  - Это соответствует логике загрузки курсов в боте

**Удаление курса:**
```
DELETE /api/course-editor/courses/{course_id}
```
- Удаляет запись из `courses.yml`
- Опционально удаляет YAML файл курса
- **Для курсов с `path: "db"`:**
  - Удаление из `courses.yml` не удаляет курс из базы данных
  - Курс останется в таблице `course` и может быть снова добавлен через `ext_courses`
  - Нужно предупредить пользователя об этом ограничении

### 4.2 Компоненты Frontend

#### Структура компонентов

**Страница списка курсов:**
- `app/course-editor/page.tsx` или `app/course-editor/list/page.tsx`
- Компонент `CourseListEditor`

**Компоненты:**
- `CourseListEditor` - основной компонент списка курсов
- `CourseMetadataForm` - форма редактирования метаданных курса
- `CourseMetadataModal` - модальное окно для редактирования метаданных
- `CourseCard` или `CourseTableRow` - элемент списка курса

**Состояния:**
- `loading` - загрузка списка курсов
- `saving` - сохранение изменений
- `error` - ошибка загрузки/сохранения
- `editingCourseId` - ID курса, который редактируется

### 4.3 Валидация и безопасность

#### TR-1: Валидация путей

**Требования:**
- Проверка на отсутствие `..` в пути (защита от path traversal)
- Проверка, что путь относительный или начинается с `scripts/`
- Разрешить путь `"db"` для курсов из базы данных
- **Нормализация путей перед сохранением:**
  - Если путь не начинается с `scripts/` и не равен `"db"`, автоматически добавлять префикс `scripts/{bot_folder}/`
  - Это соответствует логике загрузки курсов в `course.py` (метод `__init__` класса `Course`)
  - Пример: `course_file.yml` → `scripts/{bot_folder}/course_file.yml`

#### TR-2: Проверка прав доступа

**Требования:**
- Проверка прав на редактирование `courses.yml`
- Проверка прав на чтение/запись файлов курсов
- Показ сообщения об ошибке, если нет прав

**Приоритет:** Средний (можно добавить в следующей итерации)

#### TR-3: Резервное копирование

**Требования:**
- Создание backup `courses.yml` перед изменением
- Возможность восстановления из backup при ошибке

**Реализация:**
- Функция `saveCoursesYaml()` уже создает backup (см. `yaml-utils.ts`)

---

## 5. UI/UX требования

### 5.1 Макет страницы

**Структура:**
```
┌─────────────────────────────────────────┐
│  Course List Editor                    │
│  [Create Course] [Refresh]             │
├─────────────────────────────────────────┤
│                                         │
│  ┌───────────────────────────────────┐ │
│  │ Course ID │ Path │ Element │ ... │ │
│  ├───────────────────────────────────┤ │
│  │ course_1 │ ... │ ... │ [Edit]   │ │
│  │ course_2 │ ... │ ... │ [Edit]   │ │
│  └───────────────────────────────────┘ │
│                                         │
└─────────────────────────────────────────┘
```

**Альтернативный вариант (карточки):**
```
┌─────────────────────────────────────────┐
│  Course List Editor                    │
│  [Create Course]                        │
├─────────────────────────────────────────┤
│  ┌──────────┐  ┌──────────┐             │
│  │ Course 1 │  │ Course 2 │             │
│  │ Path: ...│  │ Path: ...│             │
│  │ [Edit]   │  │ [Edit]   │             │
│  └──────────┘  └──────────┘             │
└─────────────────────────────────────────┘
```

### 5.2 Форма редактирования метаданных

**Поля формы:**
- Course ID (readonly, если редактирование существующего курса)
- Path (text input, обязательное)
- Element (text input, опциональное)
- Restricted (checkbox или toggle, опциональное)
- Decline Text (textarea, опциональное)
- Ban Enabled (checkbox или toggle, опциональное)
- Ban Text (textarea, опциональное)

**Кнопки:**
- Save / Сохранить
- Cancel / Отмена
- Delete / Удалить (только для существующих курсов)

### 5.3 Индикация состояний

**Индикаторы:**
- Loading spinner при загрузке списка
- Saving indicator при сохранении изменений
- Success toast после успешного сохранения
- Error toast при ошибке
- **Предупреждения для курсов с `path: "db"`:**
  - Визуальная индикация (например, значок БД или цветовая метка)
  - Предупреждение при попытке редактирования метаданных (метаданные могут храниться в БД)
  - Предупреждение при попытке редактирования содержимого курса
  - Информационное сообщение о том, что курс управляется через базу данных

---

## 6. План реализации

### Фаза 1: Базовая функциональность (MVP)

**Цель:** Реализовать просмотр и редактирование списка курсов.

**Задачи:**

1. **Backend:**
   - [ ] Реализовать `GET /api/course-editor/courses/{course_id}/metadata`
   - [ ] Реализовать `PUT /api/course-editor/courses/{course_id}/metadata`
   - [ ] Реализовать `POST /api/course-editor/courses/metadata`
   - [ ] Добавить валидацию метаданных
   - [ ] Добавить обработку ошибок

2. **Frontend:**
   - [ ] Создать страницу `/course-editor` со списком курсов
   - [ ] Реализовать компонент `CourseListEditor`
   - [ ] Реализовать компонент `CourseMetadataModal`
   - [ ] Реализовать форму редактирования метаданных
   - [ ] Добавить кнопку перехода к редактированию курса
   - [ ] Добавить обработку состояний (loading, saving, error)
   - [ ] Добавить валидацию на клиенте

**Оценка:** 1-2 недели

### Фаза 2: Расширенная функциональность

**Задачи:**

1. **Фильтрация и поиск:**
   - [ ] Добавить поиск по course_id
   - [ ] Добавить фильтры (path, restricted, ban_enabled)

2. **Удаление курсов:**
   - [ ] Реализовать `DELETE /api/course-editor/courses/{course_id}`
   - [ ] Добавить модальное окно подтверждения удаления
   - [ ] Добавить кнопку удаления в UI

3. **Улучшения UX:**
   - [ ] Inline редактирование в таблице
   - [ ] Сортировка по столбцам
   - [ ] Пагинация для большого количества курсов

**Оценка:** 1 неделя

---

## 7. Связь с редактором курса

### Интеграция

Редактор списка курсов тесно связан с редактором курса:

1. **Навигация:**
   - Из списка курсов можно перейти к редактированию содержимого курса
   - URL: `/course-editor/[course_id]`

2. **Создание курса:**
   - При создании новой записи в списке можно сразу перейти к редактированию содержимого
   - Если файл курса не существует, создается пустой YAML файл

3. **Метаданные:**
   - Редактор курса может обновлять метаданные при сохранении (если изменились настройки курса)
   - Редактор списка курсов редактирует только метаданные, не затрагивая содержимое

### Ссылка на требования редактора курса

Подробные требования к редактору курса см. в документе:
- `docs/reqs/course_editor_production_requirements.md`

---

## 8. Критерии приемки

Редактор списка курсов считается готовым к production (MVP), если:

1. ✅ Можно просмотреть список всех курсов из `courses.yml` (включая курсы из `ext_courses`)
2. ✅ Можно редактировать метаданные курса (path, element, restricted, decline_text, ban_enabled, ban_text)
3. ✅ Можно создать новую запись курса в `courses.yml`
4. ✅ Можно перейти к редактированию содержимого курса через ссылку
5. ✅ Валидация метаданных работает на клиенте и сервере
6. ✅ Обработка ошибок работает корректно
7. ✅ Изменения сохраняются в `courses.yml` корректно
8. ✅ UI показывает состояния загрузки/сохранения
9. ✅ Курсы с `path: "db"` отображаются с соответствующим предупреждением
10. ✅ Нет потери данных при сохранении
11. ✅ Пути нормализуются автоматически (добавление префикса `scripts/{bot_folder}/` при необходимости)
12. ✅ Курсы из `ext_courses` корректно отображаются и идентифицируются

---

## 9. Примеры использования

### Пример 1: Редактирование метаданных курса

1. Пользователь открывает страницу `/course-editor`
2. Видит список всех курсов
3. Нажимает "Edit" рядом с курсом `course_greek_a1`
4. Открывается модальное окно с формой редактирования
5. Пользователь изменяет поле `restricted` на `yes`
6. Добавляет `decline_text`: "Хочешь присоединиться к курсу? Регистрируйся!"
7. Нажимает "Save"
8. Изменения сохраняются в `courses.yml`
9. Модальное окно закрывается, список обновляется

### Пример 2: Переход к редактированию курса

1. Пользователь открывает страницу `/course-editor`
2. Видит список всех курсов
3. Нажимает "Edit Course" рядом с курсом `course_greek_a1`
4. Переходит на страницу `/course-editor/course_greek_a1`
5. Открывается редактор содержимого курса

### Пример 3: Создание нового курса

1. Пользователь открывает страницу `/course-editor`
2. Нажимает "Create Course"
3. Открывается форма создания курса
4. Заполняет поля:
   - Course ID: `course_spanish_a1`
   - Path: `course_spanish_a1.yml` (путь без префикса `scripts/`)
   - Restricted: `yes`
5. Нажимает "Create"
6. Путь автоматически нормализуется до `scripts/{bot_folder}/course_spanish_a1.yml`
7. Создается запись в `courses.yml`
8. Создается пустой YAML файл курса
9. Пользователь может перейти к редактированию содержимого курса

### Пример 4: Работа с курсом из БД

1. Пользователь открывает страницу `/course-editor`
2. Видит курс `testdb` с `path: "db"` и значком БД
3. Нажимает "Edit" для редактирования метаданных
4. Появляется предупреждение: "Этот курс хранится в базе данных. Изменения метаданных в `courses.yml` могут не влиять на работу курса."
5. Пользователь подтверждает и редактирует метаданные
6. При сохранении изменения записываются в `courses.yml`, но курс остается в БД

### Пример 5: Работа с ext_courses

1. В `courses.yml` есть запись:
   ```yaml
   ext_courses:
     path: db
   ```
2. Пользователь открывает страницу `/course-editor`
3. Видит курсы из БД (например, `testdb`, `tst`) вместе с основными курсами
4. Курсы из `ext_courses` помечены специальной меткой
5. При редактировании курса из `ext_courses` показывается предупреждение о том, что курс управляется через БД

---

## 10. Связанные документы

- `docs/telegram_bot_courses.md` - **Подробная документация о работе бота с курсами и метаданными** (рекомендуется к прочтению)
- `docs/reqs/course_editor_production_requirements.md` - Требования к редактору курса
- `docs/course_editor_how_it_works.md` - Описание работы редактора курса
- `docs/database.md` - Описание структуры базы данных (таблицы `course`, `course_element`)
- `docs/architecture.md` - Общая архитектура бота
- `webapp/frontend/lib/course-editor/yaml-utils.ts` - Утилиты для работы с YAML
- `webapp/frontend/app/api/course-editor/courses/route.ts` - API endpoints для курсов
- `course.py` - Реализация класса `Course` и функции `load_courses()`

---

## 11. История изменений

| Версия | Дата | Автор | Описание |
|--------|------|-------|----------|
| 1.0 | 2024-12 | - | Первоначальная версия требований |
