# Требования к перестройке страницы курсов (/courses)

**Версия:** 1.0  
**Дата:** 2024  
**Статус:** Требования к реализации  
**Основано на:** `saas_pages_list.md`

---

## Обзор

Данный документ описывает требования к упрощенной версии страницы списка курсов (`/courses`). Страница должна быть максимально простой и функциональной, предоставляя базовые возможности управления курсами.

**Принцип дизайна:** Минимализм и простота использования. Страница должна быть интуитивно понятной и не перегруженной функциональностью.

---

## 1. Общее описание страницы

### 1.1. Путь и доступ
- **Путь:** `/courses`
- **Доступ:** Требуется авторизация
- **Статус:** ⚠️ **Требует перестройки** (существует, но требует упрощения)

### 1.2. Назначение
Страница предназначена для просмотра списка всех курсов аккаунта и выполнения базовых операций над ними: редактирование, удаление и копирование.

---

## 2. Структура страницы

### 2.1. Основной контент

Страница представляет собой простую таблицу со списком курсов. Каждая строка таблицы содержит информацию об одном курсе.

#### 2.1.1. Колонки таблицы

**Колонка 1: Название курса (Course Title)**
- Отображает название курса (`title` из таблицы `course`)
- Название является кликабельным и ведет на страницу редактирования курса
- Стиль: ссылка/кнопка, визуально выделенная

**Колонка 2: Подключенные боты (Connected Bots)**
- Отображает список ботов, на которых курс развернут (через таблицу `course_deployment`)
- Если курс не развернут ни на одном боте, отображается текст: "No bots connected" или "—"
- Если курс развернут на ботах, отображается список имен ботов (через `bot.display_name` или `bot.bot_name`)
- Формат отображения: список через запятую или badges/tags
- Справочная информация (read-only), не кликабельная

#### 2.1.2. Дополнительные колонки (опционально)
- Можно добавить колонку с датой создания/обновления (низкий приоритет)
- Можно добавить колонку со статусом (активен/неактивен) (низкий приоритет)

---

## 3. Действия над курсом

Для каждого курса доступны три действия:

### 3.1. Редактирование курса (Edit Course)

**Триггер:**
- Клик на название курса в первой колонке

**Поведение:**
- Переход на страницу редактирования курса через курс-эдитор
- Путь: `/course-editor/[courseId]` или `/courses/[courseId]/edit`
- Использует существующий компонент `CourseEditor`

**UI:**
- Название курса визуально оформлено как ссылка/кнопка
- При наведении показывается подсказка: "Click to edit course"

---

### 3.2. Удаление курса (Delete Course)

**Триггер:**
- Кнопка "Delete" или иконка корзины в строке курса

**Поведение:**

1. **Проверка зависимостей:**
   - Система проверяет, есть ли у курса активные развертывания (записи в `course_deployment` для данного `course_id`)
   - Если есть развертывания (курс подключен к ботам), удаление запрещается

2. **Если курс НЕ подключен к ботам:**
   - Показывается диалог подтверждения удаления
   - Текст диалога: "Are you sure you want to delete this course? This action cannot be undone."
   - Кнопки: "Cancel" и "Delete"
   - При подтверждении курс удаляется из базы данных
   - После удаления список курсов обновляется

3. **Если курс подключен к ботам:**
   - Показывается сообщение об ошибке/предупреждении
   - Текст сообщения: "Cannot delete course. This course is connected to one or more bots. Please remove all deployments before deleting the course."
   - Кнопка "OK" для закрытия сообщения
   - Удаление не выполняется

**UI:**
- Кнопка "Delete" или иконка корзины в колонке действий
- Модальное окно для подтверждения (если нет зависимостей)
- Модальное окно с сообщением об ошибке (если есть зависимости)

---

### 3.3. Копирование курса (Duplicate Course)

**Триггер:**
- Кнопка "Duplicate" или иконка копирования в строке курса

**Поведение:**

1. **Создание копии:**
   - Система создает полную копию курса со всеми элементами
   - Копируются все данные из таблицы `course`:
     - Все метаданные курса
     - Все элементы курса из таблицы `course_element` (полная структура)
     - Порядок элементов сохраняется
   - Новый курс получает новый уникальный `course_id` (генерируется автоматически)

2. **Название копии:**
   - Название нового курса формируется как: `[Original Title] (Copy)`
   - Пример: если оригинальный курс называется "Introduction to Python", копия будет называться "Introduction to Python (Copy)"
   - Если курс с таким названием уже существует, добавляется номер: "Introduction to Python (Copy 2)", "Introduction to Python (Copy 3)" и т.д.

3. **Переход на редактирование:**
   - После создания копии автоматически выполняется переход на страницу редактирования нового курса
   - Путь: `/course-editor/[newCourseId]`
   - Пользователь может сразу начать редактировать скопированный курс

**UI:**
- Кнопка "Duplicate" или иконка копирования в колонке действий
- При клике показывается индикатор загрузки (если операция занимает время)
- После успешного копирования выполняется редирект

---

## 4. Дополнительные элементы страницы

### 4.1. Заголовок страницы
- Заголовок: "Courses" или "Course List"
- Описание (опционально): "Manage your courses"

### 4.2. Кнопка создания нового курса
- Кнопка "Create Course" или "New Course" в верхней части страницы
- При клике переход на страницу создания курса: `/courses/new` или `/course-editor`
- Стиль: primary button, выделенный

### 4.3. Пустое состояние
- Если список курсов пуст, отображается сообщение:
  - Текст: "No courses yet. Create your first course to get started."
  - Кнопка "Create Course"

---

## 5. Технические требования

### 5.1. Backend API

**Endpoint для получения списка курсов:**
- `GET /api/v1/courses`
- Возвращает список курсов с информацией о развертываниях
- Фильтрация по `account_id = 1` (упрощено)
- Включает информацию о ботах, на которых развернут курс

**Endpoint для удаления курса:**
- `DELETE /api/v1/courses/[courseId]`
- Проверяет наличие развертываний перед удалением
- Возвращает ошибку, если курс подключен к ботам

**Endpoint для копирования курса:**
- `POST /api/v1/courses/[courseId]/duplicate`
- Создает полную копию курса со всеми элементами
- Возвращает данные нового курса (включая новый `course_id`)

### 5.2. Frontend компоненты

**Основной компонент:**
- Компонент `CoursesList` или обновление существующего `CourseListEditor`
- Использует таблицу или список для отображения курсов

**Вспомогательные компоненты:**
- Модальное окно подтверждения удаления (`DeleteConfirmDialog`)
- Модальное окно сообщения об ошибке (`ErrorMessageDialog`)
- Компонент для отображения списка ботов (`BotsList` или badges)

### 5.3. Состояние и данные

- Использование React Query для загрузки списка курсов
- Кэширование данных курсов
- Оптимистичные обновления при удалении/копировании

---

## 6. UI/UX требования

### 6.1. Язык интерфейса
- **Все тексты на английском языке**
- Кнопки, заголовки, сообщения, подсказки — все на английском

### 6.2. Стилизация
- Минималистичный дизайн
- Четкое разделение строк таблицы
- Визуальное выделение кликабельных элементов
- Консистентные цвета для действий (редактирование, удаление, копирование)

### 6.3. Адаптивность
- Таблица должна быть адаптивной для мобильных устройств
- На мобильных устройствах можно использовать карточки вместо таблицы
- Действия должны быть доступны на всех размерах экранов

### 6.4. Обратная связь
- Индикаторы загрузки при выполнении операций
- Успешные сообщения после копирования (опционально, так как есть редирект)
- Четкие сообщения об ошибках

---

## 7. Примеры текстов интерфейса (на английском)

### 7.1. Заголовки и метки
- "Courses"
- "Course List"
- "Course Title"
- "Connected Bots"
- "No bots connected"
- "Actions"

### 7.2. Кнопки
- "Create Course"
- "New Course"
- "Edit" (или клик на название)
- "Delete"
- "Duplicate"

### 7.3. Сообщения
- **Подтверждение удаления:** "Are you sure you want to delete this course? This action cannot be undone."
- **Ошибка при удалении:** "Cannot delete course. This course is connected to one or more bots. Please remove all deployments before deleting the course."
- **Пустое состояние:** "No courses yet. Create your first course to get started."
- **Подсказка при наведении на название:** "Click to edit course"

### 7.4. Модальные окна
- **Заголовок подтверждения удаления:** "Delete Course"
- **Кнопки:** "Cancel", "Delete", "OK"

---

## 8. Приоритеты реализации

### Высокий приоритет
1. ✅ Отображение списка курсов с двумя колонками (название, боты)
2. ✅ Клик на название курса → переход на редактирование
3. ✅ Кнопка удаления с проверкой зависимостей
4. ✅ Кнопка копирования с созданием полной копии

### Средний приоритет
1. Оптимизация загрузки данных (пагинация, если курсов много)
2. Поиск по курсам (опционально)
3. Сортировка курсов (опционально)

### Низкий приоритет
1. Фильтрация курсов
2. Массовые операции (выбор нескольких курсов)
3. Экспорт списка курсов

---

## 9. Зависимости

### 9.1. Существующие компоненты
- Компонент `CourseEditor` для редактирования курса
- API endpoints для работы с курсами
- Система авторизации

### 9.2. Требуемые изменения
- Обновление API endpoint для получения списка курсов (добавить информацию о развертываниях)
- Создание API endpoint для копирования курса
- Обновление логики удаления курса (проверка зависимостей)

---

## 10. Тестовые сценарии

### 10.1. Просмотр списка курсов
1. Пользователь открывает страницу `/courses`
2. Отображается список всех курсов с названиями и подключенными ботами
3. Если курсов нет, отображается пустое состояние

### 10.2. Редактирование курса
1. Пользователь кликает на название курса
2. Выполняется переход на страницу редактирования курса
3. Открывается курс-эдитор с выбранным курсом

### 10.3. Удаление курса без зависимостей
1. Пользователь кликает на кнопку "Delete" для курса без развертываний
2. Отображается диалог подтверждения
3. Пользователь подтверждает удаление
4. Курс удаляется из базы данных
5. Список курсов обновляется

### 10.4. Удаление курса с зависимостями
1. Пользователь кликает на кнопку "Delete" для курса с развертываниями
2. Отображается сообщение об ошибке
3. Курс не удаляется
4. Пользователь видит информацию о том, что нужно сначала удалить развертывания

### 10.5. Копирование курса
1. Пользователь кликает на кнопку "Duplicate" для курса
2. Система создает копию курса со всеми элементами
3. Новый курс получает название "[Original Title] (Copy)"
4. Выполняется автоматический переход на страницу редактирования нового курса
5. Пользователь может редактировать скопированный курс

---

## 11. Примечания

1. **Простота:** Страница должна быть максимально простой. Избегать излишней функциональности на первом этапе.

2. **Производительность:** При большом количестве курсов может потребоваться пагинация или виртуализация списка.

3. **Безопасность:** Все операции должны проверять права доступа пользователя (в упрощенной версии: один пользователь = полный доступ).

4. **Консистентность:** Дизайн должен соответствовать остальным страницам приложения.

5. **Расширяемость:** Структура должна позволять легко добавлять новые функции в будущем (фильтрация, поиск, сортировка).

---

**Дата создания:** 2024  
**Статус:** Требования готовы к реализации  
**Следующие шаги:** 
1. Обновление API endpoints для поддержки новой функциональности
2. Создание/обновление компонента списка курсов
3. Реализация логики удаления с проверкой зависимостей
4. Реализация логики копирования курса
5. Тестирование всех сценариев использования
