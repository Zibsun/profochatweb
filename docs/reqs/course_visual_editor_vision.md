# Vision: Визуальный редактор курсов

**Версия:** 1.0  
**Дата:** 2024  
**Статус:** Концепция  
**Приоритет:** Высокий

---

## 1. Обзор и цели

### 1.1 Зачем нужен визуальный редактор

Создание и редактирование курсов через YAML файлы требует технических знаний и понимания структуры данных. Это создает барьер для преподавателей, тренеров и других создателей контента, которые хотят создавать курсы, но не имеют навыков программирования или работы с YAML.

**Визуальный редактор решает следующие проблемы:**

1. **Доступность** — позволяет создавать курсы без знания YAML или программирования
2. **Скорость разработки** — ускоряет процесс создания и редактирования курсов
3. **Визуализация структуры** — дает наглядное представление о структуре курса и последовательности элементов
4. **Снижение ошибок** — валидация в реальном времени предотвращает синтаксические и логические ошибки
5. **Удобство навигации** — легкий переход между элементами курса для редактирования
6. **Предпросмотр** — возможность увидеть, как курс будет выглядеть для учащихся

### 1.2 Целевая аудитория редактора

**Основные пользователи:**
- Преподаватели и тренеры без технических навыков
- Создатели образовательного контента
- Администраторы курсов
- Разработчики, предпочитающие визуальный интерфейс

**Вторичные пользователи:**
- Редакторы и ревьюеры курсов
- Аналитики, изучающие структуру курсов

---

## 2. Концепция интерфейса

### 2.1 Общая структура редактора

Визуальный редактор должен предоставлять единое пространство для работы с курсом, где создатель может:

- **Видеть структуру курса** — иерархическое или последовательное представление всех элементов
- **Редактировать элементы** — изменять параметры каждого элемента через интуитивные формы
- **Управлять последовательностью** — изменять порядок элементов, добавлять новые, удалять существующие
- **Настраивать курс** — редактировать метаданные курса (название, описание, настройки доступа)
- **Тестировать курс** — запускать предпросмотр для проверки работы элементов

### 2.2 Основные области интерфейса

Редактор должен содержать следующие логические области:

1. **Область навигации по структуре курса**
   - Отображение всех элементов курса в виде списка или дерева
   - Возможность видеть модульную структуру (если курс разделен на модули)
   - Индикация текущего редактируемого элемента
   - Быстрый переход к любому элементу

2. **Область редактирования элемента**
   - Форма для редактирования параметров выбранного элемента
   - Поля ввода, соответствующие типу элемента
   - Валидация в реальном времени
   - Подсказки и документация по параметрам

3. **Область предпросмотра**
   - Отображение того, как элемент будет выглядеть для учащегося
   - Возможность протестировать интерактивные элементы (кнопки, формы ввода)
   - Показ форматирования текста (Markdown, HTML)

4. **Область управления курсом**
   - Настройки курса (метаданные, доступ, ограничения)
   - Действия с курсом (сохранение, публикация, экспорт)
   - История изменений (если поддерживается)

### 2.3 Элементы управления

**Для навигации:**
- Список/дерево элементов с возможностью раскрытия модулей
- Поиск элементов по ID или содержимому
- Фильтрация по типу элементов
- Индикаторы состояния элементов (валидные, с ошибками, новые)

**Для редактирования:**
- Формы с полями ввода, соответствующими типу элемента
- Редакторы текста с поддержкой форматирования (Markdown/HTML)
- Выпадающие списки для выбора значений
- Переключатели для булевых параметров
- Загрузка медиафайлов (изображения, аудио, видео)
- Редакторы для сложных структур (списки вариантов ответов, условия)

**Для управления последовательностью:**
- Кнопки добавления нового элемента (до/после текущего)
- Кнопки удаления элемента
- Drag-and-drop для изменения порядка элементов
- Копирование элементов

---

## 3. Редактируемые сущности

### 3.1 Метаданные курса

Редактор должен позволять редактировать:

- **Идентификатор курса** (`course_id`) — уникальный идентификатор
- **Название курса** — отображаемое название
- **Описание курса** — краткое описание содержания
- **Начальный элемент** (`element`) — элемент, с которого начинается курс
- **Настройки доступа:**
  - Ограниченный доступ (`restricted`)
  - Текст отказа (`decline_text`)
  - Блокировки (`ban_enabled`, `ban_text`)

### 3.2 Элементы курса

Каждый элемент курса должен быть полностью редактируемым через визуальный интерфейс. В зависимости от типа элемента, должны редактироваться соответствующие параметры:

**Общие параметры для всех элементов:**
- `element_id` — идентификатор элемента
- `type` — тип элемента (выбор из списка доступных типов)
- `parse_mode` — режим форматирования (MARKDOWN, HTML, HTML!)
- `link_preview` — показывать ли превью ссылок

**Специфичные параметры по типам элементов:**

- **Message** — текст, кнопка, медиафайлы
- **Dialog** — текст, промпт, модель ИИ, параметры генерации, настройки голоса
- **Quiz** — вопрос, варианты ответов, правильный ответ, обратная связь
- **Input** — вопрос, правильный ответ, обратная связь, тип нормализации
- **Question** — вопрос, варианты ответов, обратная связь
- **MultiChoice** — вопрос, варианты ответов, правильные ответы, обратная связь
- **Test** — набор вопросов, система оценивания
- **Audio** — текст, URL аудиофайлов
- **Jump** — текст, варианты навигации
- **Revision** — настройки повторения ошибок
- **Delay** — время задержки
- **End** — финальное сообщение

### 3.3 Структура и последовательность

Редактор должен позволять:

- **Добавлять элементы** — в начало, конец или между существующими элементами
- **Удалять элементы** — с подтверждением и проверкой зависимостей
- **Изменять порядок** — перемещать элементы вверх/вниз по последовательности
- **Группировать в модули** — создавать модульную структуру (например, Ex1_1, Ex1_2, Ex2_1)
- **Копировать элементы** — создавать копии с автоматической генерацией нового ID
- **Создавать связи** — настраивать переходы между элементами (для Jump элементов)

---

## 4. Функциональность редактирования

### 4.1 Создание нового элемента

При создании нового элемента редактор должен:

1. Предложить выбрать тип элемента из списка доступных типов
2. Сгенерировать уникальный `element_id` (с возможностью редактирования)
3. Открыть форму редактирования с полями, соответствующими выбранному типу
4. Предзаполнить значения по умолчанию для опциональных параметров
5. Показать подсказки и примеры для каждого поля

### 4.2 Редактирование существующего элемента

При редактировании элемента редактор должен:

1. Загрузить все параметры элемента в форму редактирования
2. Отобразить предпросмотр элемента в реальном времени
3. Валидировать вводимые данные (обязательные поля, форматы, ограничения)
4. Показывать ошибки валидации рядом с соответствующими полями
5. Предупреждать о потенциальных проблемах (например, несуществующие ссылки на другие элементы)

### 4.3 Валидация

Редактор должен проверять:

- **Синтаксическая валидность** — корректность формата данных (YAML/JSON)
- **Семантическая валидность** — соответствие значений ожидаемым типам и ограничениям
- **Структурная валидность** — наличие обязательных полей, корректность ссылок на другие элементы
- **Логическая валидность** — отсутствие циклических зависимостей, корректность навигации

Валидация должна происходить в реальном времени и блокировать сохранение при наличии критических ошибок.

### 4.4 Предпросмотр

Редактор должен предоставлять возможность:

- **Предпросмотр элемента** — видеть, как элемент будет выглядеть для учащегося
- **Предпросмотр форматирования** — видеть рендеринг Markdown/HTML
- **Тестирование интерактивности** — проверять работу кнопок, форм ввода, диалогов
- **Предпросмотр последовательности** — проходить курс от начала до конца в режиме предпросмотра

---

## 5. Сохранение и управление версиями

### 5.1 Сохранение изменений

Редактор должен поддерживать:

- **Автосохранение** — периодическое сохранение изменений в черновик
- **Ручное сохранение** — явное сохранение по запросу пользователя
- **Сохранение в разных форматах:**
  - YAML файлы (для курсов, хранящихся в файловой системе)
  - База данных (для курсов, хранящихся в БД)
  - Экспорт в YAML (для резервного копирования или миграции)

### 5.2 Управление версиями

Редактор может поддерживать:

- **История изменений** — отслеживание всех изменений курса с указанием автора и времени
- **Откат изменений** — возможность вернуться к предыдущей версии курса
- **Ветвление** — создание копий курса для экспериментов без влияния на основной курс
- **Сравнение версий** — визуальное сравнение двух версий курса для понимания изменений

### 5.3 Публикация курса

После редактирования курс должен быть доступен для:

- **Тестирования** — запуск курса в тестовом режиме для проверки
- **Публикации** — активация курса для учащихся
- **Экспорта** — сохранение курса в файл для резервного копирования или передачи

---

## 6. Интеграция с существующей системой

### 6.1 Совместимость с YAML

Визуальный редактор должен:

- **Читать существующие YAML файлы** — загружать курсы из файловой системы
- **Сохранять в YAML формат** — генерировать валидный YAML при сохранении
- **Сохранять структуру** — не изменять форматирование и комментарии, если это возможно
- **Поддерживать все типы элементов** — корректно обрабатывать все существующие типы элементов

### 6.2 Интеграция с базой данных

Редактор должен:

- **Загружать курсы из БД** — читать курсы, хранящиеся в таблице `course` и `course_element`
- **Сохранять в БД** — записывать изменения в базу данных через существующие API
- **Синхронизировать изменения** — обеспечивать согласованность данных между редактором и БД

### 6.3 Работа с медиафайлами

Редактор должен:

- **Загружать медиафайлы** — позволять загружать изображения, аудио, видео
- **Хранить ссылки** — сохранять URL или пути к медиафайлам в параметрах элементов
- **Проверять доступность** — валидировать, что медиафайлы доступны по указанным ссылкам
- **Предпросмотр медиа** — показывать миниатюры изображений и возможность воспроизведения аудио/видео

---

## 7. Пользовательский опыт

### 7.1 Простота использования

Редактор должен быть интуитивно понятным:

- **Минимум обучения** — пользователь должен начать работать без длительного обучения
- **Подсказки и документация** — встроенная помощь и примеры для каждого типа элемента
- **Ошибки понятны** — сообщения об ошибках должны быть понятными и указывать на способ исправления
- **Быстрые действия** — часто используемые действия должны быть доступны в один клик

### 7.2 Производительность

Редактор должен работать быстро:

- **Быстрая загрузка** — курсы должны загружаться быстро, даже если они большие
- **Отзывчивый интерфейс** — действия пользователя должны выполняться без заметных задержек
- **Оптимизация для больших курсов** — поддержка курсов с сотнями элементов без деградации производительности

### 7.3 Доступность

Редактор должен быть доступен:

- **Адаптивный дизайн** — работа на разных размерах экранов (десктоп, планшет)
- **Клавиатурная навигация** — возможность работы без мыши
- **Читаемость** — достаточный контраст и размер шрифтов

---

## 8. Расширяемость

### 8.1 Поддержка новых типов элементов

Редактор должен быть спроектирован так, чтобы:

- **Легко добавлять новые типы элементов** — новые типы должны интегрироваться без изменения основной логики
- **Настраивать формы редактирования** — для каждого типа элемента должна быть возможность определить свою форму редактирования
- **Добавлять валидацию** — для новых типов элементов должна быть возможность добавить специфичную валидацию

### 8.2 Интеграция с внешними сервисами

Редактор может поддерживать:

- **Интеграцию с медиа-хранилищами** — загрузка файлов в Google Drive, Dropbox и т.д.
- **Интеграцию с системами управления версиями** — синхронизация с Git для курсов в YAML
- **API для расширений** — возможность создания плагинов и расширений

---

## 9. Безопасность и права доступа

### 9.1 Контроль доступа

Редактор должен:

- **Проверять права** — только создатель курса или администратор могут редактировать курс
- **Защищать от случайных изменений** — требовать подтверждение для критических действий (удаление, публикация)
- **Логировать действия** — записывать, кто и когда внес изменения

### 9.2 Защита данных

Редактор должен:

- **Валидировать входные данные** — предотвращать внедрение вредоносного кода
- **Санитизировать контент** — очищать пользовательский ввод от потенциально опасных элементов
- **Защищать медиафайлы** — проверять загружаемые файлы на безопасность

---

## 10. Приоритеты реализации

### Фаза 1: Базовый функционал (Высокий приоритет)

1. Загрузка и отображение структуры курса
2. Редактирование основных типов элементов (Message, Quiz, Input)
3. Добавление и удаление элементов
4. Сохранение в YAML и БД
5. Базовая валидация

### Фаза 2: Расширенное редактирование (Средний приоритет)

1. Редактирование всех типов элементов
2. Предпросмотр элементов
3. Управление медиафайлами
4. Изменение порядка элементов (drag-and-drop)
5. Копирование элементов

### Фаза 3: Продвинутые функции (Низкий приоритет)

1. История изменений и откат
2. Предпросмотр всего курса
3. Поиск и фильтрация элементов
4. Экспорт/импорт курсов
5. Интеграция с внешними сервисами

---

## 11. Критерии успеха

Визуальный редактор будет считаться успешным, если:

1. **Снижение барьера входа** — пользователи без технических навыков могут создавать курсы
2. **Ускорение разработки** — создание курса занимает меньше времени, чем через YAML
3. **Снижение ошибок** — меньше синтаксических и логических ошибок в курсах
4. **Удовлетворенность пользователей** — создатели курсов предпочитают визуальный редактор YAML
5. **Совместимость** — курсы, созданные в редакторе, полностью совместимы с существующей системой

---

## 12. Связанные документы

- `docs/elements.md` — Документация по типам элементов
- `docs/dialog_element.md` — Детальная документация Dialog элемента
- `docs/reqs/PRD.md` — Product Requirements Document
- `docs/database.md` — Документация по структуре базы данных
- `docs/reqs/webversion_prd.md` — PRD веб-версии

---

## 13. История изменений

| Версия | Дата | Автор | Описание |
|--------|------|-------|----------|
| 1.0 | 2024 | - | Первоначальная версия концепции |
